<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2026 åŒ—æµ·é“å†¬ä¹‹æ—…</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">

    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { hokkaido: { bg: '#F0F9FF', primary: '#3B82F6', accent: '#60A5FA', dark: '#1E3A8A' } },
                    fontFamily: { sans: ['"Poppins"', '"Noto Sans TC"', 'sans-serif'] }
                }
            }
        }
    </script>

    <style>
        body { 
            padding-top: 80px; 
            background-color: #F0F9FF; 
            -webkit-tap-highlight-color: transparent; 
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .btn-active:active { transform: scale(0.95); }
        
        /* Modal å‹•ç•« */
        .modal-enter { opacity: 0; transform: scale(0.95); }
        .modal-enter-active { opacity: 1; transform: scale(1); transition: all 0.2s; }
        .modal-leave-active { opacity: 0; transform: scale(0.95); transition: all 0.2s; }
    </style>
</head>
<body class="bg-hokkaido-bg text-slate-700 font-sans h-screen flex flex-col overflow-hidden">

    <div id="lock-screen" class="fixed inset-0 z-50 bg-hokkaido-primary flex flex-col items-center justify-center p-8 transition-opacity duration-500">
        <div class="bg-white/10 backdrop-blur-md p-8 rounded-2xl w-full max-w-xs text-center border border-white/20 shadow-2xl">
            <div class="mb-6 text-white">
                <i class="fa-solid fa-snowflake text-4xl animate-spin-slow"></i>
                <h2 class="text-xl font-bold mt-3">Hokkaido 2026</h2>
                <p class="text-xs opacity-80">è«‹è¼¸å…¥é€šé—œå¯†ç¢¼ (2026)</p>
            </div>
            <input type="password" id="password-input" placeholder="Password" value="2026" class="w-full px-4 py-3 rounded-xl bg-white/90 text-center text-gray-700 tracking-widest font-bold mb-4 focus:outline-none">
            <button onclick="checkPassword()" class="w-full bg-hokkaido-dark text-white font-bold py-3 rounded-xl shadow-lg active:scale-95 transition-transform">é€²å…¥æ—…ç¨‹</button>
            <p id="error-msg" class="text-red-200 text-xs mt-3 hidden font-bold">å¯†ç¢¼éŒ¯èª¤</p>
        </div>
    </div>

    <header class="bg-white/80 backdrop-blur-md shadow-sm pt-12 pb-4 px-6 fixed top-0 w-full z-20">
        <h1 class="text-xl font-bold text-hokkaido-dark tracking-wide"><i class="fa-solid fa-snowflake text-hokkaido-accent mr-2"></i>Hokkaido 2026</h1>
    </header>

    <main class="flex-1 overflow-y-auto mt-4 pb-28 px-5 no-scrollbar relative">
        <div id="view-home" class="view-section space-y-6">
            <div class="bg-gradient-to-br from-blue-400 to-blue-600 rounded-2xl p-6 text-white shadow-lg shadow-blue-200">
                <div class="text-sm opacity-90 mb-1">è·é›¢å‡ºç™¼é‚„æœ‰</div>
                <div class="flex items-baseline space-x-2"><span id="countdown-days" class="text-5xl font-bold">--</span><span class="text-lg">å¤©</span></div>
                <div class="mt-4 text-sm bg-white/20 inline-block px-3 py-1 rounded-full backdrop-blur-sm">2026/01/20 å‡ºç™¼</div>
            </div>
            <div><h2 class="text-lg font-bold text-hokkaido-dark mb-3">ç•¶å‰é‡é»</h2><div id="dynamic-info-card" class="bg-white rounded-xl p-5 shadow-sm border border-blue-50"></div></div>
        </div>

        <div id="view-itinerary" class="view-section hidden">
            <div class="flex space-x-2 overflow-x-auto no-scrollbar mb-4 py-1" id="date-tabs-container"></div>
            <button onclick="openEditModal()" class="w-full bg-white border-2 border-dashed border-blue-200 text-blue-400 font-bold py-3 rounded-xl mb-6 hover:bg-blue-50 transition-colors btn-active"><i class="fa-solid fa-plus mr-2"></i>æ–°å¢æ­¤æ—¥è¡Œç¨‹</button>
            <div class="relative border-l-2 border-blue-200 ml-3 pl-6 space-y-6 pb-10" id="timeline-container"></div>
        </div>

        <div id="view-checklist" class="view-section hidden">
            <h2 class="text-lg font-bold text-hokkaido-dark mb-4">è¡Œå‰æº–å‚™æ¸…å–®</h2>
            <div class="flex flex-col gap-2 mb-6">
                <div class="flex gap-2">
                    <select id="todo-type" class="bg-white border border-gray-200 rounded-lg px-2 py-3 text-sm focus:outline-blue-500"><option value="check">ğŸ§³ æ‰˜é‹</option><option value="carry">ğŸ’ éš¨èº«</option></select>
                    <input type="text" id="new-todo-input" placeholder="æ–°å¢ç‰©å“..." class="flex-1 p-3 rounded-lg border border-gray-200 focus:outline-none focus:border-blue-500" onkeydown="if(event.key === 'Enter') addTodo()">
                </div>
                <button onclick="addTodo()" class="w-full bg-hokkaido-primary text-white py-2 rounded-lg font-bold shadow-sm btn-active"><i class="fa-solid fa-plus mr-2"></i>åŠ å…¥æ¸…å–®</button>
            </div>
            <div class="space-y-6">
                <div><h3 class="text-sm font-bold text-gray-500 mb-2 pl-1">ğŸ’ éš¨èº« / æ‰‹æ</h3><ul id="checklist-carry" class="space-y-2 min-h-[50px]"></ul></div>
                <div><h3 class="text-sm font-bold text-gray-500 mb-2 pl-1">ğŸ§³ æ‰˜é‹ / å¤§è¡Œæ</h3><ul id="checklist-check" class="space-y-2 min-h-[50px]"></ul></div>
            </div>
        </div>

        <div id="view-budget" class="view-section hidden">
            <div class="bg-white rounded-xl p-4 shadow-sm mb-6 border border-blue-50 flex divide-x divide-gray-100">
                <div class="flex-1 text-center pr-2"><div class="text-xs text-gray-400 mb-1">æ—¥å¹£ç¸½èŠ±è²»</div><div class="text-xl font-bold text-hokkaido-dark">Â¥ <span id="budget-total-jpy">0</span></div></div>
                <div class="flex-1 text-center pl-2"><div class="text-xs text-gray-400 mb-1">å°å¹£ç¸½èŠ±è²»</div><div class="text-xl font-bold text-hokkaido-dark">NT$ <span id="budget-total-twd">0</span></div></div>
            </div>
            <div class="bg-white rounded-xl p-4 shadow-sm mb-6">
                <div class="flex gap-2 mb-2">
                    <input type="text" id="budget-item" placeholder="å“é …" class="flex-[2] p-2 bg-gray-50 rounded border border-gray-100 text-sm">
                    <select id="budget-currency" class="flex-1 p-2 bg-gray-50 rounded border border-gray-100 text-sm font-bold text-gray-600"><option value="JPY">Â¥ æ—¥å¹£</option><option value="TWD">NT$ å°å¹£</option></select>
                </div>
                <div class="mb-2"><input type="number" id="budget-amount" placeholder="é‡‘é¡" class="w-full p-2 bg-gray-50 rounded border border-gray-100 text-sm"></div>
                <button onclick="addBudget()" class="w-full bg-hokkaido-accent text-white py-2 rounded-lg font-semibold shadow-sm btn-active">æ–°å¢ç´€éŒ„</button>
            </div>
            <div id="budget-list" class="space-y-2 pb-10"></div>
        </div>

        <div id="view-apps" class="view-section hidden">
            <h2 class="text-lg font-bold text-hokkaido-dark mb-4">æ—¥æœ¬æ—…éŠ App ç®¡ç†</h2>
            <div class="bg-white p-4 rounded-xl shadow-sm mb-6 border border-gray-100">
                <div class="grid grid-cols-1 gap-3 mb-3">
                    <input type="text" id="app-name-input" placeholder="App åç¨±" class="w-full p-2 bg-gray-50 rounded border border-gray-200 focus:outline-blue-400 text-sm">
                    <input type="text" id="app-desc-input" placeholder="åŠŸèƒ½èªªæ˜" class="w-full p-2 bg-gray-50 rounded border border-gray-200 focus:outline-blue-400 text-sm">
                </div>
                <button onclick="addNewApp()" class="w-full bg-hokkaido-primary text-white py-2 rounded-lg font-bold text-sm shadow-sm btn-active"><i class="fa-solid fa-plus mr-1"></i> æ–°å¢ App</button>
            </div>
            <div id="apps-container" class="grid grid-cols-2 gap-4 pb-10"></div>
        </div>
    </main>

    <div id="itinerary-modal" class="fixed inset-0 z-50 bg-black/50 hidden flex items-center justify-center p-4 backdrop-blur-sm" onclick="closeModal('itinerary-modal')">
        <div class="bg-white rounded-2xl w-full max-w-sm overflow-hidden shadow-2xl transform transition-all scale-95" onclick="event.stopPropagation()">
            <div id="modal-header-img" class="h-40 bg-gray-200 bg-cover bg-center hidden relative"><div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent"></div></div>
            <div class="p-6">
                <div class="flex justify-between items-start mb-4"><div><span id="modal-time" class="inline-block bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full font-bold mb-2">10:00</span><h3 id="modal-title" class="text-xl font-bold text-gray-800"></h3></div><button onclick="closeModal('itinerary-modal')" class="text-gray-400 hover:text-gray-600"><i class="fa-solid fa-xmark text-xl"></i></button></div>
                <div class="space-y-4"><div class="flex items-start text-sm text-gray-600"><i class="fa-solid fa-location-dot mt-1 mr-3 text-red-400 w-4 text-center"></i><span id="modal-address" class="flex-1"></span></div><div class="flex items-start text-sm text-gray-600"><i class="fa-solid fa-note-sticky mt-1 mr-3 text-yellow-500 w-4 text-center"></i><p id="modal-note" class="flex-1 whitespace-pre-wrap leading-relaxed"></p></div></div>
                <div class="mt-6 flex gap-3"><a id="modal-link-btn" href="#" target="_blank" class="flex-1 bg-hokkaido-primary text-white text-center py-2.5 rounded-xl font-bold shadow-md hover:bg-blue-600 transition-colors hidden"><i class="fa-solid fa-arrow-up-right-from-square mr-2"></i>é–‹å•Ÿé€£çµ</a><button id="modal-delete-btn" class="bg-red-50 text-red-500 px-4 py-2.5 rounded-xl font-bold hover:bg-red-100 transition-colors"><i class="fa-solid fa-trash-can"></i></button></div>
            </div>
        </div>
    </div>
    <div id="edit-modal" class="fixed inset-0 z-50 bg-black/50 hidden flex items-center justify-center p-4 backdrop-blur-sm" onclick="closeModal('edit-modal')">
        <div class="bg-white rounded-2xl w-full max-w-sm p-6 shadow-2xl" onclick="event.stopPropagation()">
            <h3 class="text-lg font-bold mb-4 text-hokkaido-dark">æ–°å¢/ç·¨è¼¯è¡Œç¨‹</h3>
            <div class="space-y-3"><div class="grid grid-cols-2 gap-3"><input type="date" id="edit-date" class="p-2 border rounded-lg bg-gray-50 text-sm w-full"><input type="time" id="edit-time" class="p-2 border rounded-lg bg-gray-50 text-sm w-full"></div><input type="text" id="edit-title" placeholder="åœ°é»åç¨±" class="w-full p-2 border rounded-lg bg-gray-50 text-sm"><input type="text" id="edit-address" placeholder="åœ°å€" class="w-full p-2 border rounded-lg bg-gray-50 text-sm"><input type="text" id="edit-link" placeholder="é€£çµ (é¸å¡«)" class="w-full p-2 border rounded-lg bg-gray-50 text-sm"><textarea id="edit-note" placeholder="å‚™è¨»..." rows="3" class="w-full p-2 border rounded-lg bg-gray-50 text-sm"></textarea><button onclick="saveItinerary()" class="w-full bg-hokkaido-primary text-white py-3 rounded-xl font-bold shadow-md mt-2 btn-active">å„²å­˜è¡Œç¨‹</button></div>
        </div>
    </div>
    <nav class="fixed bottom-0 w-full bg-white border-t border-gray-100 pb-safe pt-2 px-4 pb-4 shadow-[0_-5px_15px_rgba(0,0,0,0.03)] z-30">
        <div class="grid grid-cols-5 gap-1 items-center">
            <button onclick="switchTab('home')" class="nav-btn active flex flex-col items-center space-y-1 text-hokkaido-primary w-full" data-target="home"><i class="fa-solid fa-house text-xl"></i><span class="text-[10px]">é¦–é </span></button>
            <button onclick="switchTab('itinerary')" class="nav-btn flex flex-col items-center space-y-1 text-gray-400 w-full" data-target="itinerary"><i class="fa-solid fa-calendar-days text-xl"></i><span class="text-[10px]">è¡Œç¨‹</span></button>
            <button onclick="switchTab('checklist')" class="nav-btn flex flex-col items-center space-y-1 text-gray-400 w-full" data-target="checklist"><i class="fa-solid fa-list-check text-xl"></i><span class="text-[10px]">æ¸…å–®</span></button>
            <button onclick="switchTab('budget')" class="nav-btn flex flex-col items-center space-y-1 text-gray-400 w-full" data-target="budget"><i class="fa-solid fa-yen-sign text-xl"></i><span class="text-[10px]">è¨˜å¸³</span></button>
            <button onclick="switchTab('apps')" class="nav-btn flex flex-col items-center space-y-1 text-gray-400 w-full" data-target="apps"><i class="fa-solid fa-mobile-screen text-xl"></i><span class="text-[10px]">å·¥å…·</span></button>
        </div>
    </nav>

    <script src="app.js"></script>

    <script>
        const TABS = ['home', 'itinerary', 'checklist', 'budget', 'apps'];
        const oldSwitch = window.switchTab;
        window.switchTab = function(tabName) {
            if(typeof oldSwitch === 'function') oldSwitch(tabName);
            if(tabName === 'apps') renderApps();
            if(tabName === 'checklist') renderTodos();
            if(tabName === 'budget') renderBudget();
            if(tabName === 'itinerary') renderItinerary();
        };

        /* === 1. è¡Œç¨‹ç®¡ç† (å®Œæ•´è¼¸å…¥ç‰ˆ) === */
        let itinerary = JSON.parse(localStorage.getItem('hokkaido_itinerary')) || [
            // Day 1: 1/20
            { id: 101, date: '2026-01-20', time: '09:30', title: 'âœˆï¸ é•·æ¦® BR116 èµ·é£›', address: 'æ¡ƒåœ’åœ‹éš›æ©Ÿå ´ T2', note: '09:30 èµ·é£› - 14:05 æŠµé”ã€‚é£›è¡Œ 3hr 35mã€‚' },
            { id: 102, date: '2026-01-20', time: '14:05', title: 'ğŸ›¬ æŠµé”æ–°åƒæ­²', address: 'æ–°åƒæ­²æ©Ÿå ´', link: 'https://www.new-chitose-airport.jp/tw/', note: 'å…¥å¢ƒå¾Œå‰å¾€æœ­å¹Œã€‚' },
            { id: 103, date: '2026-01-20', time: '16:30', title: 'ğŸ¨ Check-in: åˆ©å¤«é¦¬å…‹æ–¯', address: 'åˆ©å¤«é¦¬å…‹æ–¯ç¶“æ¿Ÿå‹é£¯åº—-æœ­å¹Œç«™å‰åº—', note: 'å–®å¼µåºŠæˆ¿ (ç¦è¸)ã€‚ä½ 1 æ™šã€‚' },
            // Day 2: 1/21
            { id: 201, date: '2026-01-21', time: '10:00', title: 'ğŸ¨ é€€æˆ¿ & ç§»å‹•', address: 'å‰å¾€æ˜Ÿé‡æ¸¡å‡æ‘', note: 'é€€æˆ¿ï¼Œå‰å¾€ Resonare Tomamuã€‚' },
            { id: 202, date: '2026-01-21', time: '15:00', title: 'ğŸ¨ Check-in: Resonare', address: 'æ˜Ÿé‡ RISONARE Tomamu', link: 'https://www.snowtomamu.jp/', note: 'å…¥ä½ Resonareï¼Œä½ 2 æ™šã€‚' },
            // Day 3: 1/22
            { id: 301, date: '2026-01-22', time: '09:00', title: 'â„ï¸ æ˜Ÿé‡å…¨æ—¥è‡ªç”±æ´»å‹•', address: 'RISONARE Tomamu', note: 'æ»‘é›ª / éœ§å†°å¹³å° / å¾®ç¬‘æµ·ç˜ã€‚' },
            // Day 4: 1/23
            { id: 401, date: '2026-01-23', time: '11:00', title: 'ğŸ¨ é€€æˆ¿ & è¿”å›æœ­å¹Œ', address: 'å‰å¾€æœ­å¹Œå¸‚å€', note: 'é›¢é–‹æ˜Ÿé‡ï¼Œè¿”å›æœ­å¹Œã€‚' },
            { id: 402, date: '2026-01-23', time: '16:00', title: 'ğŸ¨ Check-in: æ¢ç´‹ä½å®…é£¯åº—', address: 'æœ­å¹Œæ¢ç´‹ä½å®…é£¯åº— (Stripe Hotel)', note: 'æ¨™æº–æˆ¿ï¼Œä½ 2 æ™šã€‚' },
            // Day 5: 1/24
            { id: 501, date: '2026-01-24', time: '10:00', title: 'ğŸ›ï¸ æœ­å¹Œå¸‚å€ä¸€æ—¥éŠ', address: 'æœ­å¹Œ', note: 'å…¨æ—¥è‡ªç”±è¡Œã€‚' },
            // Day 6: 1/25
            { id: 601, date: '2026-01-25', time: '10:00', title: 'ğŸ¨ é€€æˆ¿: æ¢ç´‹ä½å®…é£¯åº—', address: 'æœ­å¹Œ', note: 'æœ€å¾Œæ¡è²·ï¼Œæº–å‚™å‰å¾€æ©Ÿå ´ã€‚' },
            { id: 602, date: '2026-01-25', time: '16:30', title: 'ğŸš… æŠµé”æ–°åƒæ­²æ©Ÿå ´', address: 'æ–°åƒæ­²æ©Ÿå ´', note: 'é…·èˆª TR893 (18:40 èµ·é£›)ã€‚è¨˜å¾—é€›åœ‹å…§ç·šè²·ä¼´æ‰‹ç¦®ã€‚' },
            { id: 603, date: '2026-01-25', time: '18:40', title: 'âœˆï¸ é…·èˆª TR893 èµ·é£›', address: 'æ–°åƒæ­²æ©Ÿå ´ I', note: '18:40 èµ·é£› - 22:30 æŠµé”æ¡ƒåœ’ T1ã€‚' }
        ];

        let currentItineraryDate = '2026-01-20';
        function generateDateTabs() {
            const container = document.getElementById('date-tabs-container');
            if(!container) return;
            container.innerHTML = '';
            const startDate = new Date('2026-01-20');
            for(let i=0; i<7; i++) {
                const d = new Date(startDate);
                d.setDate(startDate.getDate() + i);
                const dateStr = d.toISOString().split('T')[0];
                const dayStr = (d.getMonth()+1) + '/' + d.getDate();
                const btn = document.createElement('button');
                btn.className = `px-4 py-2 rounded-full text-sm font-bold whitespace-nowrap transition-colors ${currentItineraryDate === dateStr ? 'bg-hokkaido-primary text-white shadow-md' : 'bg-white text-gray-500 border border-gray-100'}`;
                btn.innerText = `Day ${i+1} (${dayStr})`;
                btn.onclick = () => { currentItineraryDate = dateStr; renderItinerary(); };
                container.appendChild(btn);
            }
        }
        function renderItinerary() {
            generateDateTabs();
            const container = document.getElementById('timeline-container');
            if(!container) return;
            container.innerHTML = '';
            const daysItems = itinerary.filter(i => i.date === currentItineraryDate).sort((a,b) => a.time.localeCompare(b.time));
            if(daysItems.length === 0) { container.innerHTML = '<div class="text-gray-400 text-sm italic py-4">é€™å¤©é‚„æ²’æœ‰è¡Œç¨‹ï¼ŒæŒ‰ä¸Šé¢çš„æŒ‰éˆ•æ–°å¢å§ï¼</div>'; return; }
            daysItems.forEach(item => {
                container.innerHTML += `<div class="relative group cursor-pointer hover:bg-blue-50/50 p-2 -ml-2 rounded-lg transition-colors" onclick="openItineraryDetail(${item.id})"><div class="absolute -left-[31px] top-3 w-4 h-4 bg-hokkaido-accent rounded-full border-4 border-white shadow-sm z-10"></div><div class="flex items-start"><span class="font-mono text-blue-500 font-bold mr-4 text-sm mt-0.5">${item.time}</span><div class="flex-1"><h3 class="font-bold text-gray-800 text-sm">${item.title}</h3><p class="text-xs text-gray-500 mt-1 line-clamp-1">${item.address || 'ç„¡åœ°å€è³‡è¨Š'}</p>${item.note ? `<div class="mt-1 text-[10px] text-gray-400 bg-gray-50 inline-block px-1.5 py-0.5 rounded border border-gray-100 max-w-full truncate"><i class="fa-solid fa-note-sticky mr-1"></i>${item.note}</div>` : ''}</div><i class="fa-solid fa-chevron-right text-gray-300 text-xs mt-2"></i></div></div>`;
            });
        }
        function openItineraryDetail(id) {
            const item = itinerary.find(i => i.id === id);
            if(!item) return;
            document.getElementById('modal-title').innerText = item.title;
            document.getElementById('modal-time').innerText = item.time;
            document.getElementById('modal-address').innerText = item.address || 'ç„¡åœ°å€';
            document.getElementById('modal-note').innerText = item.note || 'ç„¡å‚™è¨»';
            const linkBtn = document.getElementById('modal-link-btn'), imgHeader = document.getElementById('modal-header-img'), isImg = item.link && (item.link.match(/\.(jpeg|jpg|gif|png)$/)!=null || item.link.includes('imgur'));
            if(item.link) { if(isImg){ imgHeader.style.backgroundImage = `url('${item.link}')`; imgHeader.classList.remove('hidden'); linkBtn.classList.add('hidden'); } else { imgHeader.classList.add('hidden'); linkBtn.href = item.link; linkBtn.classList.remove('hidden'); } } else { imgHeader.classList.add('hidden'); linkBtn.classList.add('hidden'); }
            document.getElementById('modal-delete-btn').onclick = () => deleteItinerary(id);
            document.getElementById('itinerary-modal').classList.remove('hidden');
        }
        function openEditModal() { document.getElementById('edit-date').value = currentItineraryDate; document.getElementById('edit-time').value = '10:00'; document.getElementById('edit-title').value = ''; document.getElementById('edit-address').value = ''; document.getElementById('edit-link').value = ''; document.getElementById('edit-note').value = ''; document.getElementById('edit-modal').classList.remove('hidden'); }
        function closeModal(id) { document.getElementById(id).classList.add('hidden'); }
        function saveItinerary() { const d=document.getElementById('edit-date').value, t=document.getElementById('edit-title').value; if(!d||!t){alert('æ—¥æœŸå’Œæ¨™é¡Œå¿…å¡«');return;} itinerary.push({id:Date.now(),date:d,time:document.getElementById('edit-time').value,title:t,address:document.getElementById('edit-address').value,link:document.getElementById('edit-link').value,note:document.getElementById('edit-note').value}); itinerary.sort((a,b)=>(a.date+a.time).localeCompare(b.date+b.time)); localStorage.setItem('hokkaido_itinerary',JSON.stringify(itinerary)); closeModal('edit-modal'); currentItineraryDate=d; renderItinerary(); }
        function deleteItinerary(id) { if(confirm('åˆªé™¤?')){ itinerary=itinerary.filter(i=>i.id!==id); localStorage.setItem('hokkaido_itinerary',JSON.stringify(itinerary)); closeModal('itinerary-modal'); renderItinerary(); } }

        /* === Apps & Checklist & Budget === */
        let myApps=JSON.parse(localStorage.getItem('hokkaido_apps'))||[{name:"ä¹˜æ›æ¡ˆå…§",desc:"æŸ¥é›»è»Šæ™‚åˆ»",icon:"fa-train",color:"bg-green-500"},{name:"Google Map",desc:"æ‰¾è·¯/è©•åƒ¹",icon:"fa-map-location-dot",color:"bg-blue-600"},{name:"Payke",desc:"æƒè—¥å¦æˆåˆ†",icon:"fa-barcode",color:"bg-pink-500"},{name:"VoiceTra",desc:"èªéŸ³ç¿»è­¯",icon:"fa-language",color:"bg-indigo-500"},{name:"Suica App",desc:"è¥¿ç“œå¡å„²å€¼",icon:"fa-credit-card",color:"bg-green-700"},{name:"Uber",desc:"å¤ªç´¯å«è»Šç”¨",icon:"fa-car",color:"bg-black"}];
        function renderApps(){const c=document.getElementById('apps-container');if(!c)return;c.innerHTML='';myApps.forEach((a,i)=>{c.innerHTML+=`<div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100 relative group flex flex-col items-center text-center"><button onclick="deleteApp(${i})" class="absolute top-2 right-2 text-gray-300 hover:text-red-500 p-1"><i class="fa-solid fa-trash-can"></i></button><button onclick="copyAppText('${a.name}')" class="absolute top-2 left-2 text-gray-300 hover:text-blue-500 p-1 active:text-blue-700"><i class="fa-regular fa-copy"></i></button><div class="w-12 h-12 ${a.color||'bg-blue-400'} rounded-2xl flex items-center justify-center text-white text-xl shadow-md mb-2"><i class="fa-solid ${a.icon||'fa-mobile-screen'}"></i></div><h3 class="font-bold text-gray-800 text-sm mb-1">${a.name}</h3><p class="text-[10px] text-gray-500 leading-tight">${a.desc}</p></div>`;});localStorage.setItem('hokkaido_apps',JSON.stringify(myApps));}
        function addNewApp(){const n=document.getElementById('app-name-input').value.trim();if(!n)return;myApps.unshift({name:n,desc:document.getElementById('app-desc-input').value.trim()||"è‡ªè¨‚",icon:"fa-star",color:"bg-hokkaido-accent"});document.getElementById('app-name-input').value='';renderApps();}
        function deleteApp(i){if(confirm('åˆªé™¤?')){myApps.splice(i,1);renderApps();}}
        function copyAppText(t){navigator.clipboard.writeText(t).then(()=>alert(`å·²è¤‡è£½: ${t}`)).catch(()=>prompt("è«‹æ‰‹å‹•è¤‡è£½",t));}

        let todos=[];try{const s=localStorage.getItem('hokkaido_todos');todos=s?JSON.parse(s):[];if(todos.length&&typeof todos[0]==='string')todos=todos.map(t=>({text:t,done:false,type:'check'}));}catch(e){todos=[];}
        function renderTodos(){const c1=document.getElementById('checklist-carry'),c2=document.getElementById('checklist-check');if(!c1||!c2)return;c1.innerHTML='';c2.innerHTML='';todos.forEach((t,i)=>{const h=`<li class="flex items-center bg-white p-3 rounded-xl shadow-sm border ${t.done?'border-green-200 bg-green-50':'border-gray-100'}"><button onclick="toggleTodo(${i})" class="w-6 h-6 rounded-full border-2 mr-3 flex items-center justify-center ${t.done?'bg-green-500 border-green-500':'border-gray-300'}">${t.done?'<i class="fa-solid fa-check text-white text-xs"></i>':''}</button><span class="flex-1 ${t.done?'line-through text-gray-400':'text-gray-700'}">${t.text}</span><button onclick="removeTodo(${i})" class="text-gray-300 hover:text-red-400 px-2"><i class="fa-solid fa-xmark"></i></button></li>`;if(t.type==='carry')c1.innerHTML+=h;else c2.innerHTML+=h;});localStorage.setItem('hokkaido_todos',JSON.stringify(todos));}
        function addTodo(){const t=document.getElementById('new-todo-input').value.trim();if(t){todos.push({text:t,done:false,type:document.getElementById('todo-type').value});document.getElementById('new-todo-input').value='';renderTodos();}}
        function toggleTodo(i){todos[i].done=!todos[i].done;renderTodos();}
        function removeTodo(i){if(confirm('åˆªé™¤?')){todos.splice(i,1);renderTodos();}}

        let budgetList=JSON.parse(localStorage.getItem('hokkaido_budget'))||[];
        function renderBudget(){const l=document.getElementById('budget-list'),tj=document.getElementById('budget-total-jpy'),tt=document.getElementById('budget-total-twd');if(!l)return;l.innerHTML='';let j=0,t=0;budgetList.forEach((b,i)=>{const c=b.currency||'JPY',a=Number(b.amount),s=c==='JPY'?'Â¥':'NT$';if(c==='JPY')j+=a;else t+=a;l.innerHTML+=`<div class="flex justify-between items-center bg-white p-3 rounded-lg shadow-sm border border-gray-100 relative group"><div class="flex-1"><div class="font-bold text-gray-700">${b.item}</div><div class="text-xs text-gray-400"><span class="${c==='JPY'?'text-blue-500':'text-green-600'} font-bold bg-gray-100 px-1 rounded mr-1">${c}</span>${new Date(b.date).toLocaleDateString()}</div></div><div class="font-bold text-lg text-hokkaido-dark mr-8">${s} ${a.toLocaleString()}</div><button onclick="deleteBudget(${i})" class="absolute right-2 text-gray-300 hover:text-red-400 p-1"><i class="fa-solid fa-trash-can"></i></button></div>`;});if(tj)tj.innerText=j.toLocaleString();if(tt)tt.innerText=t.toLocaleString();localStorage.setItem('hokkaido_budget',JSON.stringify(budgetList));}
        function addBudget(){const i=document.getElementById('budget-item').value.trim(),a=document.getElementById('budget-amount').value,c=document.getElementById('budget-currency').value;if(i&&a){budgetList.unshift({item:i,amount:a,currency:c,date:new Date().toISOString()});document.getElementById('budget-item').value='';document.getElementById('budget-amount').value='';renderBudget();}else alert("è¼¸å…¥ä¸å®Œæ•´");}
        function deleteBudget(i){if(confirm('åˆªé™¤?')){budgetList.splice(i,1);renderBudget();}}

        document.addEventListener('DOMContentLoaded', () => { renderApps(); renderTodos(); renderBudget(); renderItinerary(); });
    </script>
</body>
</html>
