<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2026 åŒ—æµ·é“å†¬ä¹‹æ—…</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">

    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { hokkaido: { bg: '#F0F9FF', primary: '#3B82F6', accent: '#60A5FA', dark: '#1E3A8A' } },
                    fontFamily: { sans: ['"Poppins"', '"Noto Sans TC"', 'sans-serif'] }
                }
            }
        }
    </script>

    <style>
        body { 
            padding-top: 80px; 
            background-color: #F0F9FF; 
            -webkit-tap-highlight-color: transparent; 
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* æŒ‰éˆ•å‹•ç•« */
        .btn-active:active { transform: scale(0.95); }
    </style>
</head>
<body class="bg-hokkaido-bg text-slate-700 font-sans h-screen flex flex-col overflow-hidden">

    <div id="lock-screen" class="fixed inset-0 z-50 bg-hokkaido-primary flex flex-col items-center justify-center p-8 transition-opacity duration-500">
        <div class="bg-white/10 backdrop-blur-md p-8 rounded-2xl w-full max-w-xs text-center border border-white/20 shadow-2xl">
            <div class="mb-6 text-white">
                <i class="fa-solid fa-snowflake text-4xl animate-spin-slow"></i>
                <h2 class="text-xl font-bold mt-3">Hokkaido 2026</h2>
                <p class="text-xs opacity-80">è«‹è¼¸å…¥é€šé—œå¯†ç¢¼ (2026)</p>
            </div>
            <input type="password" id="password-input" placeholder="Password" value="2026" class="w-full px-4 py-3 rounded-xl bg-white/90 text-center text-gray-700 tracking-widest font-bold mb-4 focus:outline-none">
            <button onclick="checkPassword()" class="w-full bg-hokkaido-dark text-white font-bold py-3 rounded-xl shadow-lg active:scale-95 transition-transform">é€²å…¥æ—…ç¨‹</button>
            <p id="error-msg" class="text-red-200 text-xs mt-3 hidden font-bold">å¯†ç¢¼éŒ¯èª¤</p>
        </div>
    </div>

    <header class="bg-white/80 backdrop-blur-md shadow-sm pt-12 pb-4 px-6 fixed top-0 w-full z-20">
        <h1 class="text-xl font-bold text-hokkaido-dark tracking-wide"><i class="fa-solid fa-snowflake text-hokkaido-accent mr-2"></i>Hokkaido 2026</h1>
    </header>

    <main class="flex-1 overflow-y-auto mt-4 pb-28 px-5 no-scrollbar relative">
        <div id="view-home" class="view-section space-y-6">
            <div class="bg-gradient-to-br from-blue-400 to-blue-600 rounded-2xl p-6 text-white shadow-lg shadow-blue-200">
                <div class="text-sm opacity-90 mb-1">è·é›¢å‡ºç™¼é‚„æœ‰</div>
                <div class="flex items-baseline space-x-2"><span id="countdown-days" class="text-5xl font-bold">--</span><span class="text-lg">å¤©</span></div>
                <div class="mt-4 text-sm bg-white/20 inline-block px-3 py-1 rounded-full backdrop-blur-sm">2026/01/20 å‡ºç™¼</div>
            </div>
            <div><h2 class="text-lg font-bold text-hokkaido-dark mb-3">ç•¶å‰é‡é»</h2><div id="dynamic-info-card" class="bg-white rounded-xl p-5 shadow-sm border border-blue-50"></div></div>
        </div>

        <div id="view-itinerary" class="view-section hidden">
            <div class="flex space-x-2 overflow-x-auto no-scrollbar mb-4 py-1" id="date-tabs-container"></div>
            <div class="relative border-l-2 border-blue-200 ml-3 pl-6 space-y-6" id="timeline-container"></div>
        </div>

        <div id="view-checklist" class="view-section hidden">
            <h2 class="text-lg font-bold text-hokkaido-dark mb-4">è¡Œå‰æº–å‚™æ¸…å–®</h2>
            
            <div class="flex flex-col gap-2 mb-6">
                <div class="flex gap-2">
                    <select id="todo-type" class="bg-white border border-gray-200 rounded-lg px-2 py-3 text-sm focus:outline-blue-500">
                        <option value="check">ğŸ§³ æ‰˜é‹</option>
                        <option value="carry">ğŸ’ éš¨èº«</option>
                    </select>
                    <input type="text" id="new-todo-input" placeholder="æ–°å¢ç‰©å“..." 
                           class="flex-1 p-3 rounded-lg border border-gray-200 focus:outline-none focus:border-blue-500"
                           onkeydown="if(event.key === 'Enter') addTodo()">
                </div>
                <button onclick="addTodo()" class="w-full bg-hokkaido-primary text-white py-2 rounded-lg font-bold shadow-sm btn-active"><i class="fa-solid fa-plus mr-2"></i>åŠ å…¥æ¸…å–®</button>
            </div>

            <div class="space-y-6">
                <div>
                    <h3 class="text-sm font-bold text-gray-500 mb-2 pl-1">ğŸ’ éš¨èº« / æ‰‹æ</h3>
                    <ul id="checklist-carry" class="space-y-2 min-h-[50px]"></ul>
                </div>
                
                <div>
                    <h3 class="text-sm font-bold text-gray-500 mb-2 pl-1">ğŸ§³ æ‰˜é‹ / å¤§è¡Œæ</h3>
                    <ul id="checklist-check" class="space-y-2 min-h-[50px]"></ul>
                </div>
            </div>
        </div>

        <div id="view-budget" class="view-section hidden">
            <div class="bg-white rounded-xl p-5 shadow-sm mb-6 border border-blue-50 text-center">
                <div class="text-sm text-gray-500 mb-1">ç›®å‰ç¸½æ¶ˆè²» (æ—¥å¹£)</div>
                <div class="text-3xl font-bold text-hokkaido-dark">Â¥ <span id="budget-total">0</span></div>
            </div>
            <div class="bg-white rounded-xl p-4 shadow-sm mb-6">
                <div class="grid grid-cols-3 gap-2 mb-2">
                    <input type="text" id="budget-item" placeholder="å“é …" class="col-span-2 p-2 bg-gray-50 rounded border border-gray-100">
                    <input type="number" id="budget-amount" placeholder="é‡‘é¡" class="col-span-1 p-2 bg-gray-50 rounded border border-gray-100">
                </div>
                <button onclick="addBudget()" class="w-full bg-hokkaido-accent text-white py-2 rounded font-semibold shadow-sm btn-active">æ–°å¢ç´€éŒ„</button>
            </div>
            <div id="budget-list" class="space-y-2 pb-10"></div>
        </div>

        <div id="view-apps" class="view-section hidden">
            <h2 class="text-lg font-bold text-hokkaido-dark mb-4">æ—¥æœ¬æ—…éŠ App ç®¡ç†</h2>
            
            <div class="bg-white p-4 rounded-xl shadow-sm mb-6 border border-gray-100">
                <div class="grid grid-cols-1 gap-3 mb-3">
                    <input type="text" id="app-name-input" placeholder="App åç¨± (å¦‚: Uber)" class="w-full p-2 bg-gray-50 rounded border border-gray-200 focus:outline-blue-400 text-sm">
                    <input type="text" id="app-desc-input" placeholder="åŠŸèƒ½èªªæ˜ (å¦‚: å«è»Šç”¨)" class="w-full p-2 bg-gray-50 rounded border border-gray-200 focus:outline-blue-400 text-sm">
                </div>
                <button onclick="addNewApp()" class="w-full bg-hokkaido-primary text-white py-2 rounded-lg font-bold text-sm shadow-sm btn-active transition-transform"><i class="fa-solid fa-plus mr-1"></i> æ–°å¢ App</button>
            </div>

            <div id="apps-container" class="grid grid-cols-2 gap-4 pb-10"></div>
        </div>
    </main>
    <nav class="fixed bottom-0 w-full bg-white border-t border-gray-100 pb-safe pt-2 px-4 pb-4 shadow-[0_-5px_15px_rgba(0,0,0,0.03)] z-30">
        <div class="grid grid-cols-5 gap-1 items-center">
            <button onclick="switchTab('home')" class="nav-btn active flex flex-col items-center space-y-1 text-hokkaido-primary w-full" data-target="home"><i class="fa-solid fa-house text-xl"></i><span class="text-[10px]">é¦–é </span></button>
            <button onclick="switchTab('itinerary')" class="nav-btn flex flex-col items-center space-y-1 text-gray-400 w-full" data-target="itinerary"><i class="fa-solid fa-calendar-days text-xl"></i><span class="text-[10px]">è¡Œç¨‹</span></button>
            <button onclick="switchTab('checklist')" class="nav-btn flex flex-col items-center space-y-1 text-gray-400 w-full" data-target="checklist"><i class="fa-solid fa-list-check text-xl"></i><span class="text-[10px]">æ¸…å–®</span></button>
            <button onclick="switchTab('budget')" class="nav-btn flex flex-col items-center space-y-1 text-gray-400 w-full" data-target="budget"><i class="fa-solid fa-yen-sign text-xl"></i><span class="text-[10px]">è¨˜å¸³</span></button>
            <button onclick="switchTab('apps')" class="nav-btn flex flex-col items-center space-y-1 text-gray-400 w-full" data-target="apps"><i class="fa-solid fa-mobile-screen text-xl"></i><span class="text-[10px]">å·¥å…·</span></button>
        </div>
    </nav>

    <script src="app.js"></script>

    <script>
        /* === 1. App ç®¡ç†åŠŸèƒ½ (å«è¤‡è£½) === */
        let myApps = JSON.parse(localStorage.getItem('hokkaido_apps')) || [
            { name: "ä¹˜æ›æ¡ˆå…§", desc: "æŸ¥é›»è»Šæ™‚åˆ»", icon: "fa-train", color: "bg-green-500" },
            { name: "Google Map", desc: "æ‰¾è·¯/è©•åƒ¹", icon: "fa-map-location-dot", color: "bg-blue-600" },
            { name: "Payke", desc: "æƒè—¥å¦æˆåˆ†", icon: "fa-barcode", color: "bg-pink-500" },
            { name: "VoiceTra", desc: "èªéŸ³ç¿»è­¯", icon: "fa-language", color: "bg-indigo-500" },
            { name: "Suica App", desc: "è¥¿ç“œå¡å„²å€¼", icon: "fa-credit-card", color: "bg-green-700" },
            { name: "Uber", desc: "å¤ªç´¯å«è»Šç”¨", icon: "fa-car", color: "bg-black" }
        ];

        function renderApps() {
            const container = document.getElementById('apps-container');
            if(!container) return;
            container.innerHTML = '';
            
            myApps.forEach((app, index) => {
                const card = `
                    <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100 relative group flex flex-col items-center text-center">
                        <button onclick="deleteApp(${index})" class="absolute top-2 right-2 text-gray-300 hover:text-red-500 p-1 transition-colors"><i class="fa-solid fa-trash-can"></i></button>
                        
                        <button onclick="copyAppText('${app.name}')" class="absolute top-2 left-2 text-gray-300 hover:text-blue-500 p-1 transition-colors active:text-blue-700">
                            <i class="fa-regular fa-copy"></i>
                        </button>

                        <div class="w-12 h-12 ${app.color || 'bg-blue-400'} rounded-2xl flex items-center justify-center text-white text-xl shadow-md mb-2">
                            <i class="fa-solid ${app.icon || 'fa-mobile-screen'}"></i>
                        </div>
                        <h3 class="font-bold text-gray-800 text-sm mb-1 select-all">${app.name}</h3>
                        <p class="text-[10px] text-gray-500 leading-tight">${app.desc}</p>
                    </div>
                `;
                container.innerHTML += card;
            });
            localStorage.setItem('hokkaido_apps', JSON.stringify(myApps));
        }

        function addNewApp() {
            const name = document.getElementById('app-name-input').value.trim();
            const desc = document.getElementById('app-desc-input').value.trim();
            if (!name) { alert("è«‹è‡³å°‘è¼¸å…¥ App åç¨±å–”ï¼"); return; }
            myApps.unshift({ name: name, desc: desc || "è‡ªè¨‚ App", icon: "fa-star", color: "bg-hokkaido-accent" });
            document.getElementById('app-name-input').value = '';
            document.getElementById('app-desc-input').value = '';
            renderApps();
        }

        function deleteApp(index) {
            if(confirm('ç¢ºå®šè¦åˆªé™¤ ' + myApps[index].name + ' å—ï¼Ÿ')) {
                myApps.splice(index, 1);
                renderApps();
            }
        }

        // è¤‡è£½åŠŸèƒ½
        function copyAppText(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert(`å·²è¤‡è£½ã€Œ${text}ã€ï¼\nè«‹ç›´æ¥å» App Store æœå°‹ä¸‹è¼‰`);
            }).catch(err => {
                console.error('è¤‡è£½å¤±æ•—:', err);
                prompt("è«‹æ‰‹å‹•è¤‡è£½:", text);
            });
        }

        /* === 2. æ¸…å–®ç®¡ç†åŠŸèƒ½ (åˆ†é¡ç‰ˆ) === */
        // å–å¾—èˆŠè³‡æ–™ï¼Œä¸¦ç¢ºä¿å®ƒæ˜¯é™£åˆ—
        let todos = [];
        try {
            const stored = localStorage.getItem('hokkaido_todos');
            todos = stored ? JSON.parse(stored) : [];
            // å¦‚æœèˆŠè³‡æ–™æ˜¯ç´”å­—ä¸²é™£åˆ—(èˆŠç‰ˆ)ï¼ŒæŠŠå®ƒè½‰æˆæ–°æ ¼å¼
            if(todos.length > 0 && typeof todos[0] === 'string') {
                todos = todos.map(t => ({ text: t, done: false, type: 'check' }));
            }
        } catch(e) {
            todos = [];
        }

        function renderTodos() {
            const carryList = document.getElementById('checklist-carry');
            const checkList = document.getElementById('checklist-check');
            if(!carryList || !checkList) return;

            carryList.innerHTML = '';
            checkList.innerHTML = '';

            todos.forEach((todo, index) => {
                const li = document.createElement('li');
                li.className = `flex items-center bg-white p-3 rounded-xl shadow-sm border ${todo.done ? 'border-green-200 bg-green-50' : 'border-gray-100'}`;
                li.innerHTML = `
                    <button onclick="toggleTodo(${index})" class="w-6 h-6 rounded-full border-2 mr-3 flex items-center justify-center transition-colors ${todo.done ? 'bg-green-500 border-green-500' : 'border-gray-300'}">
                        ${todo.done ? '<i class="fa-solid fa-check text-white text-xs"></i>' : ''}
                    </button>
                    <span class="flex-1 ${todo.done ? 'line-through text-gray-400' : 'text-gray-700'}">${todo.text}</span>
                    <button onclick="removeTodo(${index})" class="text-gray-300 hover:text-red-400 px-2"><i class="fa-solid fa-xmark"></i></button>
                `;

                // æ ¹æ“šé¡å‹æ”¾åˆ°ä¸åŒæ¸…å–®ï¼Œé è¨­æ”¾æ‰˜é‹
                if (todo.type === 'carry') {
                    carryList.appendChild(li);
                } else {
                    checkList.appendChild(li);
                }
            });
            localStorage.setItem('hokkaido_todos', JSON.stringify(todos));
        }

        function addTodo() {
            const input = document.getElementById('new-todo-input');
            const typeSelect = document.getElementById('todo-type');
            const text = input.value.trim();
            
            if (text) {
                // æ–°å¢æ ¼å¼ï¼š{ text: "å…§å®¹", done: false, type: "carry/check" }
                todos.push({ 
                    text: text, 
                    done: false, 
                    type: typeSelect.value 
                });
                input.value = '';
                renderTodos();
            }
        }

        function toggleTodo(index) {
            todos[index].done = !todos[index].done;
            renderTodos();
        }

        function removeTodo(index) {
            if(confirm('ç¢ºå®šåˆªé™¤å—ï¼Ÿ')) {
                todos.splice(index, 1);
                renderTodos();
            }
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            renderApps();
            renderTodos();
            
            // ç¶å®šåˆ‡æ›åˆ†é æ™‚é‡æ–°æ¸²æŸ“
            const oldSwitch = window.switchTab;
            window.switchTab = function(tabName) {
                if(typeof oldSwitch === 'function') oldSwitch(tabName);
                if(tabName === 'apps') renderApps();
                if(tabName === 'checklist') renderTodos();
            };
        });
    </script>
</body>
</html>
