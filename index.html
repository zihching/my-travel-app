import React, { useState, useEffect, useMemo } from 'react';
import { 
  MapPin, 
  Calendar, 
  Heart, 
  Search, 
  User, 
  Plus, 
  Minus, 
  Star, 
  Clock, 
  ChevronLeft,
  Share2,
  Navigation,
  MessageCircle,
  Wallet,
  MoreHorizontal,
  Bus,
  Train,
  Car,
  Ship,
  Plane,
  Camera,
  X,
  Smile,
  Coffee
} from 'lucide-react';

// --- é¢¨æ ¼è¨­å®š (Cute Theme) ---
const THEME = {
  bg: "bg-[#FFF9F2]",      // æº«æš–çš„å¥¶æ²¹ç±³è‰²
  card: "bg-white",        // ç´”ç™½å¡ç‰‡
  primary: "bg-[#8B5E3C]", // ç‰›å¥¶å·§å…‹åŠ›è‰² (ä¸»æŒ‰éˆ•)
  primaryLight: "bg-[#DBC1AC]", // æ·ºå¥¶èŒ¶è‰²
  accentPink: "bg-[#FFE5E5] text-[#FF8BA7]", // è‰è“ç²‰ (æ¨™ç±¤/æ„›å¿ƒ)
  accentYellow: "bg-[#FFF8D6] text-[#F4C430]", // å¥¶æ²¹é»ƒ (æ˜Ÿæ˜Ÿ/äº®é»)
  accentBlue: "bg-[#E3F2FD] text-[#64B5F6]", // å¯¶å¯¶è— (è£é£¾)
  textMain: "text-[#5D4037]", // æ·±å’–å•¡æ–‡å­— (æ¯”ç´”é»‘æŸ”å’Œ)
  textSub: "text-[#9D8168]",  // æ·ºå’–å•¡æ–‡å­—
  input: "bg-[#FFFCF8] border-[#F2E8DE]", // æŸ”å’Œè¼¸å…¥æ¡†
  shadow: "shadow-[0_8px_20px_-6px_rgba(139,94,60,0.1)]", // å¸¶æš–è‰²èª¿çš„è»Ÿé™°å½±
  radius: "rounded-[32px]", // è¶…ç´šåœ“è§’
};

// --- æ¨¡æ“¬æ•¸æ“š ---
const SUGGESTED_DESTINATIONS = [
  {
    id: 1,
    title: "å°åŒ— 101 è§€æ™¯å°",
    location: "å°åŒ—, å°ç£",
    category: "åŸå¸‚",
    rating: 4.8,
    price: 600,
    image: "https://images.unsplash.com/photo-1596711683416-562db932ba53?q=80&w=800&auto=format&fit=crop",
    description: "å»é«˜ç©ºçœ‹é¢¨æ™¯ï¼Œåƒåœ¨é›²ç«¯ä¸Šä¸€æ¨£ âœ¨"
  },
  {
    id: 2,
    title: "æ¸…æ°´å¯ºæ•£ç­–",
    location: "äº¬éƒ½, æ—¥æœ¬",
    category: "æ–‡åŒ–",
    rating: 4.9,
    price: 120,
    image: "https://images.unsplash.com/photo-1582239023570-87d296603a11?q=80&w=800&auto=format&fit=crop",
    description: "ç©¿è‘—å’Œæœåœ¨å¤è€å¯ºé™¢æ¼«æ­¥ï¼Œè¶…ç´šæµªæ¼« ğŸŒ¸"
  },
  {
    id: 3,
    title: "çš‡åé®å¤§å†’éšª",
    location: "ç´è¥¿è˜­",
    category: "è‡ªç„¶",
    rating: 4.9,
    price: 4500,
    image: "https://images.unsplash.com/photo-1507525428034-b723cf961d3e?q=80&w=800&auto=format&fit=crop",
    description: "è·³å‚˜ã€é«˜ç©ºé¦éŸ†ï¼Œå¿ƒè·³åŠ é€Ÿçš„æ„Ÿè¦ºï¼ â¤ï¸"
  },
  {
    id: 4,
    title: "å¯æ„›å“ˆæ¯”æ‘",
    location: "ç´è¥¿è˜­",
    category: "æ–‡åŒ–",
    rating: 4.8,
    price: 1800,
    image: "https://images.unsplash.com/photo-1574351651322-63b7115d7325?q=80&w=800&auto=format&fit=crop",
    description: "èµ°é€²ç«¥è©±ä¸–ç•Œï¼Œå°‹æ‰¾æ¯”çˆ¾åšçš„å®¶ ğŸ¡"
  }
];

const CATEGORIES = ["å…¨éƒ¨ âœ¨", "åŸå¸‚ ğŸ™ï¸", "è‡ªç„¶ ğŸŒ³", "æµ·å³¶ ğŸ–ï¸", "æ–‡åŒ– â›©ï¸"];

// --- è¼”åŠ©çµ„ä»¶ (Components) ---

// 1. åº•éƒ¨å°èˆª (å¯æ„›æ¼‚æµ®ç‰ˆ)
const BottomNav = ({ activeTab, setActiveTab }) => {
  const navItems = [
    { id: 'itinerary', icon: Calendar, label: 'è¡Œç¨‹' },
    { id: 'explore', icon: Search, label: 'æ¢ç´¢' },
    { id: 'saved', icon: Heart, label: 'æ”¶è—' },
    { id: 'chat', icon: MessageCircle, label: 'èŠå¤©' },
    { id: 'budget', icon: Wallet, label: 'éŒ¢åŒ…' },
  ];

  return (
    <div className="fixed bottom-0 left-0 right-0 px-6 pb-6 pt-0 z-50 pointer-events-none flex justify-center">
      <div className={`pointer-events-auto bg-white/90 backdrop-blur-md border border-white/50 px-6 py-4 ${THEME.radius} ${THEME.shadow} flex justify-between items-center w-full max-w-sm`}>
        {navItems.map((item) => {
          const Icon = item.icon;
          const isActive = activeTab === item.id;
          return (
            <button
              key={item.id}
              onClick={() => setActiveTab(item.id)}
              className={`flex flex-col items-center justify-center transition-all duration-300 relative group`}
            >
              {/* Active Indicator Blob */}
              {isActive && (
                <div className="absolute -top-1 w-10 h-10 bg-[#FFF4E6] rounded-full -z-10 scale-100 transition-transform"></div>
              )}
              
              <Icon 
                size={24} 
                strokeWidth={isActive ? 2.5 : 2} 
                className={`transition-colors duration-300 ${isActive ? 'text-[#8B5E3C] transform -translate-y-1' : 'text-[#DBC1AC]'}`}
              />
              {isActive && (
                 <div className="w-1 h-1 bg-[#8B5E3C] rounded-full mt-1"></div>
              )}
            </button>
          );
        })}
      </div>
    </div>
  );
};

// 2. é ‚éƒ¨æ¨™é¡Œåˆ—
const Header = ({ title, subtitle, rightIcon: RightIcon, onRightClick }) => (
  <div className={`px-6 pt-6 pb-2 flex justify-between items-center ${THEME.bg} sticky top-0 z-40`}>
    <button className={`p-3 bg-white rounded-full ${THEME.shadow} ${THEME.textMain} hover:scale-105 transition-transform`}>
      <ChevronLeft size={22} />
    </button>
    <div className="text-center">
      <h1 className={`text-xl font-bold ${THEME.textMain} tracking-wide`}>{title}</h1>
      {subtitle && (
        <div className="flex items-center justify-center mt-1">
          <span className="inline-block w-2 h-2 bg-[#A5D6A7] rounded-full mr-2 animate-pulse"></span>
          <span className="text-xs text-[#8D6E63] font-medium tracking-widest">{subtitle}</span>
        </div>
      )}
    </div>
    <button onClick={onRightClick} className={`p-3 bg-white rounded-full ${THEME.shadow} ${THEME.textMain} hover:scale-105 transition-transform`}>
      {RightIcon ? <RightIcon size={22} /> : <div className="w-6" />}
    </button>
  </div>
);

// 3. æ™¯é»å¡ç‰‡ (æŸ”å’Œç‰ˆ)
const DestinationCard = ({ destination, onAdd }) => (
  <div className={`bg-white ${THEME.radius} overflow-hidden ${THEME.shadow} mb-5 break-inside-avoid group hover:-translate-y-1 transition-transform duration-300`}>
    <div className="relative h-44 p-3 pb-0">
      <img src={destination.image} alt={destination.title} className={`w-full h-full object-cover ${THEME.radius}`} />
      <div className={`absolute top-5 right-5 ${THEME.accentYellow} px-2 py-1 rounded-full text-xs font-bold flex items-center shadow-sm`}>
        <Star size={12} className="fill-current mr-1" />
        {destination.rating}
      </div>
    </div>
    <div className="p-4 pt-3">
      <h3 className={`font-bold ${THEME.textMain} text-lg mb-1`}>{destination.title}</h3>
      <p className={`text-xs ${THEME.textSub} mb-3 line-clamp-2 leading-relaxed`}>{destination.description}</p>
      
      <div className="flex justify-between items-center mt-2">
        <div className={`${THEME.accentBlue} px-3 py-1 rounded-full text-xs font-bold`}>
           ${destination.price}
        </div>
        <button 
          onClick={(e) => {
            e.stopPropagation();
            onAdd(destination);
          }}
          className={`${THEME.primary} text-white p-2.5 rounded-full shadow-md hover:bg-[#7A4E32] hover:scale-110 active:scale-90 transition-all`}
        >
          <Plus size={18} strokeWidth={3} />
        </button>
      </div>
    </div>
  </div>
);

// --- é é¢å…§å®¹ (Views) ---

// 1. è¡Œç¨‹é é¢
const ItineraryView = ({ items, onOpenAdd, onDelete }) => {
  const [activeDay, setActiveDay] = useState(1);

  return (
    <div className={`min-h-screen ${THEME.bg} pb-32`}>
      <Header title="ç´è¥¿è˜­ä¹‹æ—… ğŸ¥" subtitle="ONLINE" rightIcon={MoreHorizontal} />
      
      {/* Day Selector (Bubbly Style) */}
      <div className="px-6 mt-4 flex items-center space-x-3 overflow-x-auto no-scrollbar py-2">
        {[1, 2, 3].map(day => (
          <button 
            key={day}
            onClick={() => setActiveDay(day)}
            className={`min-w-[64px] h-[80px] ${THEME.radius} flex flex-col items-center justify-center transition-all duration-300 border-2 ${
              activeDay === day 
                ? `${THEME.primary} border-transparent text-white shadow-lg scale-105` 
                : 'bg-white border-transparent text-[#DBC1AC] hover:bg-[#FFF4E6]'
            }`}
          >
            <span className="text-[10px] font-bold tracking-wider mb-1 opacity-80">DAY</span>
            <span className="text-2xl font-black">{day}</span>
          </button>
        ))}
        <button className={`min-w-[64px] h-[80px] ${THEME.radius} border-2 border-dashed border-[#DBC1AC] text-[#DBC1AC] flex items-center justify-center bg-transparent hover:bg-white/50 transition-colors`}>
          <Plus size={24} />
        </button>
      </div>

      {/* Flight Card (Ticket Style) */}
      <div className="px-6 mt-6">
        <div className={`bg-white ${THEME.radius} p-5 ${THEME.shadow} relative overflow-hidden`}>
          {/* Decorative circles */}
          <div className="absolute -left-3 top-1/2 -translate-y-1/2 w-6 h-6 bg-[#FFF9F2] rounded-full"></div>
          <div className="absolute -right-3 top-1/2 -translate-y-1/2 w-6 h-6 bg-[#FFF9F2] rounded-full"></div>
          
          <div className="flex justify-between items-center mb-1">
            <span className="text-xs font-bold text-[#DBC1AC] uppercase tracking-wider flex items-center gap-1">
              <Plane size={12}/> Flight
            </span>
            <span className="text-xs text-[#FFB7B2] font-bold bg-[#FFE5E5] px-2 py-0.5 rounded-full">Save</span>
          </div>
          <div className={`flex items-center text-2xl font-black ${THEME.textMain} mt-1`}>
            BR198 âœˆï¸
          </div>
        </div>
      </div>

      {/* Timeline / Items */}
      <div className="px-6 mt-6 space-y-4 relative">
        {/* Dotted Line */}
        {items.length > 0 && (
          <div className="absolute left-[38px] top-4 bottom-4 w-0.5 border-l-2 border-dashed border-[#E5D0BF] z-0"></div>
        )}

        {items.length === 0 ? (
          <div className="flex flex-col items-center justify-center py-24 opacity-60">
            <div className="bg-white p-6 rounded-full shadow-sm mb-4">
               <Coffee size={40} className="text-[#DBC1AC]" />
            </div>
            <p className={`mt-2 ${THEME.textMain} font-medium`}>é‚„æ²’æœ‰è¡Œç¨‹è€¶</p>
            <p className={`text-xs ${THEME.textSub}`}>é»æ“Šå³ä¸‹è§’æ–°å¢ä¸€å€‹å§ï¼</p>
          </div>
        ) : (
          items.map((item, idx) => (
            <div key={idx} className={`bg-white ${THEME.radius} p-4 ${THEME.shadow} flex gap-4 relative z-10 hover:scale-[1.02] transition-transform`}>
               <div className="flex flex-col items-center">
                 <div className={`w-14 h-14 ${THEME.accentYellow} rounded-2xl flex items-center justify-center text-xs font-bold text-[#D4A017] shadow-inner`}>
                    {item.time || "10:00"}
                 </div>
               </div>
               <div className="flex-1 py-1">
                 <h3 className={`font-bold text-lg ${THEME.textMain}`}>{item.title}</h3>
                 <div className="flex items-center text-[#9D8168] text-xs mt-1.5 font-medium">
                   {item.transport === 'walk' && <User size={12} className="mr-1"/>}
                   {item.location}
                 </div>
               </div>
               <button onClick={() => onDelete(item.id)} className="absolute top-2 right-2 p-2 text-[#E5D0BF] hover:text-[#FF8BA7] transition-colors">
                 <X size={16} strokeWidth={3} />
               </button>
            </div>
          ))
        )}
      </div>

      {/* Floating Add Button */}
      <button 
        onClick={onOpenAdd}
        className={`fixed bottom-28 right-6 w-16 h-16 ${THEME.primary} rounded-[28px] text-white shadow-xl shadow-[#8B5E3C]/30 flex items-center justify-center hover:scale-110 active:scale-95 transition-all z-40`}
      >
        <Plus size={32} strokeWidth={3} />
      </button>
    </div>
  );
};

// 2. æ¢ç´¢é é¢
const ExploreView = ({ onAddToPlan }) => {
  const [searchTerm, setSearchTerm] = useState("");
  const [activeCategory, setActiveCategory] = useState("å…¨éƒ¨ âœ¨");

  const filtered = useMemo(() => {
    return SUGGESTED_DESTINATIONS.filter(d => 
      (activeCategory.includes("å…¨éƒ¨") || activeCategory.includes(d.category)) &&
      d.title.includes(searchTerm)
    );
  }, [searchTerm, activeCategory]);

  return (
    <div className={`min-h-screen ${THEME.bg} pb-32`}>
      <div className="px-6 pt-8 mb-6">
        <h1 className={`text-2xl font-bold ${THEME.textMain} mb-2`}>æ¢ç´¢æ™¯é» ğŸ—ºï¸</h1>
        <p className={`${THEME.textSub} text-sm`}>ç‚ºä½ çš„ç´è¥¿è˜­ä¹‹æ—…å°‹æ‰¾éˆæ„Ÿ</p>
      </div>

      {/* Search */}
      <div className="px-6 mb-6">
        <div className="relative group">
          <div className="absolute inset-0 bg-[#E5D0BF]/20 rounded-[24px] transform translate-y-1 transition-transform group-focus-within:translate-y-2"></div>
          <div className={`relative bg-white ${THEME.radius} flex items-center px-4 py-3 border-2 border-transparent focus-within:border-[#DBC1AC]`}>
            <Search className="text-[#DBC1AC] mr-3" size={20} />
            <input 
              type="text"
              placeholder="æƒ³å»å“ªè£¡ç©ï¼Ÿ"
              className={`w-full bg-transparent text-sm outline-none ${THEME.textMain} placeholder:text-[#E5D0BF]`}
              value={searchTerm}
              onChange={(e) => setSearchTerm(e.target.value)}
            />
          </div>
        </div>
      </div>

      {/* Categories */}
      <div className="flex px-6 space-x-3 overflow-x-auto pb-6 no-scrollbar">
        {CATEGORIES.map(cat => (
          <button
            key={cat}
            onClick={() => setActiveCategory(cat)}
            className={`px-5 py-2.5 rounded-full whitespace-nowrap text-sm font-bold transition-all ${
              activeCategory === cat 
                ? `${THEME.primary} text-white shadow-lg shadow-[#8B5E3C]/20 transform -translate-y-0.5` 
                : 'bg-white text-[#DBC1AC] hover:bg-[#FFF4E6]'
            }`}
          >
            {cat}
          </button>
        ))}
      </div>

      {/* Masonry Grid */}
      <div className="px-6 columns-2 gap-5 space-y-5">
        {filtered.map(dest => (
          <DestinationCard key={dest.id} destination={dest} onAdd={onAddToPlan} />
        ))}
      </div>
    </div>
  );
};

// 3. åˆ†å¸³é é¢
const BudgetView = () => (
  <div className={`min-h-screen ${THEME.bg} pb-32`}>
    <Header title="éŒ¢åŒ… ğŸ‘›" subtitle="ONLINE" />
    <div className="px-6 mt-6">
      {/* Piggy Bank Card */}
      <div className={`${THEME.primary} rounded-[40px] p-8 text-[#FFFDF5] shadow-xl relative overflow-hidden`}>
        {/* Cute blobs */}
        <div className="absolute -top-10 -right-10 w-40 h-40 bg-[#A98467] rounded-full opacity-50 blur-3xl"></div>
        <div className="absolute -bottom-10 -left-10 w-32 h-32 bg-[#A98467] rounded-full opacity-50 blur-3xl"></div>
        
        <div className="relative z-10 flex flex-col items-center">
          <p className="text-sm font-medium opacity-80 mb-2 tracking-widest uppercase">Total Budget</p>
          <h2 className="text-5xl font-black mb-6 tracking-tight">$0</h2>
          
          <div className="w-full bg-white/10 rounded-2xl p-4 flex justify-between items-center backdrop-blur-sm">
             <div className="flex flex-col items-center w-1/2 border-r border-white/10">
                <span className="text-xs opacity-70 mb-1">æ¯äººæ‡‰ä»˜</span>
                <span className="font-bold text-lg">$0</span>
             </div>
             <div className="flex flex-col items-center w-1/2">
                <span className="text-xs opacity-70 mb-1">äººæ•¸</span>
                <span className="font-bold text-lg">1 äºº</span>
             </div>
          </div>
        </div>
      </div>
    </div>

    <div className="px-6 mt-12 flex flex-col items-center justify-center opacity-40">
      <div className="w-20 h-20 bg-white rounded-full flex items-center justify-center mb-4 shadow-sm">
         <Wallet size={32} className={THEME.textMain} />
      </div>
      <p className={`mt-2 text-sm font-medium ${THEME.textMain}`}>é‚„æ²’æœ‰è¨˜å¸³ç´€éŒ„å–”</p>
    </div>
  </div>
);

// 4. èŠå¤©é é¢
const ChatView = () => (
  <div className={`min-h-screen ${THEME.bg} flex flex-col`}>
    <Header title="èŠå¤©å®¤ ğŸ’¬" subtitle="ONLINE" rightIcon={MoreHorizontal} />
    <div className="flex-1 px-6 py-4 space-y-6">
       <div className="flex justify-end group">
         <div className="flex items-end gap-3 flex-row-reverse">
            <div className="w-10 h-10 rounded-full bg-[#E5D0BF] overflow-hidden border-2 border-white shadow-sm">
               <img src="https://images.unsplash.com/photo-1534528741775-53994a69daeb?q=80&w=200&auto=format&fit=crop" alt="" />
            </div>
            <div className={`${THEME.primary} text-white px-5 py-3 rounded-[24px] rounded-tr-none text-sm shadow-sm leading-relaxed`}>
              æˆ‘å€‘ç­‰ç­‰å»å“ªè£¡ï¼Ÿ ğŸ¦
            </div>
         </div>
       </div>
       
       <div className="flex justify-start">
         <div className="flex items-end gap-3">
            <div className="w-10 h-10 rounded-full bg-[#FFD1DC] overflow-hidden border-2 border-white shadow-sm flex items-center justify-center">
               <span className="text-xs font-bold text-white">Bot</span>
            </div>
            <div className={`bg-white ${THEME.textMain} px-5 py-3 rounded-[24px] rounded-tl-none text-sm shadow-sm border border-[#F2E8DE] leading-relaxed`}>
              æˆ‘æƒ³å»åƒé‚£é–“å¾ˆæœ‰åçš„é¬†é¤…ï¼ğŸ¥
            </div>
         </div>
       </div>
    </div>

    {/* Input Area */}
    <div className="p-4 px-6 bg-white/80 backdrop-blur-md pb-28 border-t border-[#F2E8DE]">
      <div className="flex gap-3 items-center">
        <button className="p-3 text-[#DBC1AC] bg-[#FFF9F2] rounded-2xl hover:bg-[#FFE5E5] hover:text-[#FF8BA7] transition-colors"><Camera size={22}/></button>
        <div className="flex-1 relative">
           <input type="text" placeholder="è¼¸å…¥è¨Šæ¯..." className="w-full bg-[#FFF9F2] rounded-[24px] px-5 py-3 text-sm outline-none text-[#5D4037] placeholder:text-[#E5D0BF]" />
           <button className="absolute right-2 top-1/2 -translate-y-1/2 p-1.5 text-[#DBC1AC] hover:text-[#8B5E3C]">
              <Smile size={20}/>
           </button>
        </div>
        <button className={`${THEME.primary} text-white p-3 rounded-2xl shadow-md hover:scale-105 transition-transform`}><Navigation size={20} className="rotate-90"/></button>
      </div>
    </div>
  </div>
);

// 5. æ–°å¢è¡Œç¨‹ Modal (è²¼ç´™é¢¨æ ¼)
const AddItemModal = ({ isOpen, onClose, onSave, initialData }) => {
  const [title, setTitle] = useState(initialData?.title || "");
  const [time, setTime] = useState(initialData?.time || "10:00");
  const [location, setLocation] = useState(initialData?.location || "");

  useEffect(() => {
    if (initialData) {
      setTitle(initialData.title || "");
      setLocation(initialData.location || "");
    }
  }, [initialData]);

  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 z-[60] flex items-end justify-center sm:items-center">
      <div className="absolute inset-0 bg-[#5D4037]/20 backdrop-blur-sm transition-opacity" onClick={onClose}></div>
      <div className={`bg-[#FFF9F2] w-full max-w-md rounded-t-[40px] sm:rounded-[40px] p-8 relative animate-in slide-in-from-bottom-10 duration-300 max-h-[90vh] overflow-y-auto shadow-2xl`}>
        
        {/* Handle bar for mobile feel */}
        <div className="w-12 h-1.5 bg-[#E5D0BF] rounded-full mx-auto mb-8 opacity-50"></div>

        <div className="flex justify-between items-center mb-8">
          <h2 className={`text-2xl font-black ${THEME.textMain}`}>æ–°å¢è¡Œç¨‹ âœ¨</h2>
          <button onClick={onClose} className="bg-white p-2 rounded-full shadow-sm hover:rotate-90 transition-transform"><X size={20} className="text-[#DBC1AC]" /></button>
        </div>

        {/* Form Inputs */}
        <div className="space-y-5">
          <div className="flex gap-4">
             <div className="w-1/3">
               <div className="bg-white border-2 border-[#F2E8DE] rounded-3xl p-4 h-full flex items-center justify-center font-bold text-[#8B5E3C] text-lg shadow-sm">
                 {time}
               </div>
             </div>
             <div className="flex-1">
               <input 
                 type="text" 
                 placeholder="æ¨™é¡Œ" 
                 className="w-full h-full bg-white border-2 border-[#F2E8DE] rounded-3xl px-6 outline-none focus:border-[#DBC1AC] text-[#5D4037] placeholder:text-[#E5D0BF] font-bold shadow-sm"
                 value={title}
                 onChange={(e) => setTitle(e.target.value)}
               />
             </div>
          </div>

          <div className="bg-white border-2 border-[#F2E8DE] rounded-3xl p-5 shadow-sm">
             <p className="text-xs text-[#9D8168] font-bold mb-4 uppercase tracking-wider">äº¤é€š & æ™‚é–“</p>
             <div className="flex justify-between px-1 mb-4">
                {[User, Bus, Train, Car, Ship, Plane].map((Icon, idx) => (
                  <button key={idx} className={`p-3 rounded-2xl transition-all ${idx === 0 ? 'bg-[#FFF8D6] text-[#F4C430] scale-110' : 'text-[#DBC1AC] hover:bg-[#FFF9F2]'}`}>
                    <Icon size={22} strokeWidth={2.5} />
                  </button>
                ))}
             </div>
             <div className="bg-[#FFF9F2] rounded-2xl p-3 text-center text-xs text-[#9D8168] font-medium border border-[#F2E8DE]">
               é ä¼°æ™‚é–“ (è‡ªå‹•è¨ˆç®—) â±ï¸
             </div>
          </div>

          <div className="bg-white border-2 border-[#F2E8DE] rounded-3xl p-5 space-y-4 shadow-sm">
             <div className="flex bg-[#FFF9F2] rounded-2xl p-1.5">
               <button className="flex-1 py-2 text-xs font-bold text-[#8B5E3C] bg-white rounded-xl shadow-sm">æœå°‹</button>
               <button className="flex-1 py-2 text-xs font-bold text-[#DBC1AC]">åœ°åœ–</button>
             </div>
             
             <div className="flex items-center bg-[#E3F2FD] rounded-2xl px-4 py-3 text-[#64B5F6] text-sm font-bold justify-center cursor-pointer hover:bg-[#BBDEFB] transition-colors">
                <Navigation size={16} className="mr-2 fill-current" />
                å®šä½ç›®å‰ä½ç½® ğŸ“
             </div>

             <div className="flex gap-3">
               <input 
                  type="text" 
                  placeholder="è¼¸å…¥åœ°é»..." 
                  className="flex-1 bg-[#FFF9F2] rounded-2xl px-4 py-3 text-sm outline-none text-[#5D4037] placeholder:text-[#E5D0BF]"
                  value={location}
                  onChange={(e) => setLocation(e.target.value)}
               />
               <button className={`${THEME.primary} text-white px-5 rounded-2xl text-sm font-bold hover:scale-105 transition-transform`}>Go</button>
             </div>
          </div>

          <div className="border-2 border-dashed border-[#E5D0BF] rounded-3xl py-6 flex flex-col items-center justify-center text-[#DBC1AC] cursor-pointer hover:bg-white hover:border-[#8B5E3C] transition-all bg-[#FFF9F2]/50">
             <Camera size={28} className="mb-2" />
             <span className="text-xs font-bold">åŠ å¼µç…§ç‰‡ ğŸ“¸</span>
          </div>
        </div>

        <div className="flex gap-4 mt-10">
          <button onClick={onClose} className="flex-1 bg-[#F2E8DE] py-4 rounded-[24px] font-bold text-[#9D8168] hover:bg-[#E5D0BF] transition-colors">å–æ¶ˆ</button>
          <button 
            onClick={() => {
              onSave({ id: Date.now(), title, time, location, transport: 'walk' });
              onClose();
            }} 
            className={`flex-1 ${THEME.primary} py-4 rounded-[24px] font-bold text-white shadow-lg shadow-[#8B5E3C]/20 hover:scale-105 transition-transform`}
          >
            å„²å­˜ âœ¨
          </button>
        </div>

      </div>
    </div>
  );
};

// --- App ä¸»ç¨‹å¼ ---

export default function App() {
  const [activeTab, setActiveTab] = useState('itinerary');
  const [itineraryItems, setItineraryItems] = useState([]);
  const [isAddModalOpen, setIsAddModalOpen] = useState(false);
  const [modalInitialData, setModalInitialData] = useState(null);

  // 1. å¼·åˆ¶ç¦æ­¢ç¿»è­¯ (å°ä»˜ç†±å¿ƒçš„ç€è¦½å™¨)
  useEffect(() => {
    const meta = document.createElement('meta');
    meta.name = "google";
    meta.content = "notranslate";
    document.head.appendChild(meta);
    return () => {
      // Cleanup if needed (rare in this single file context but good practice)
      try { document.head.removeChild(meta); } catch(e) {}
    }
  }, []);

  const handleAddToPlan = (destination) => {
    setModalInitialData({
      title: destination.title,
      location: destination.location
    });
    setIsAddModalOpen(true);
  };

  const handleSaveItem = (item) => {
    setItineraryItems([...itineraryItems, item]);
    setActiveTab('itinerary');
  };

  const handleDeleteItem = (id) => {
    setItineraryItems(prev => prev.filter(i => i.id !== id));
  };

  return (
    // 2. åŠ å…¥ translate="no" å’Œ notranslate class é›™é‡ä¿éšª
    <div className={`font-sans text-[#5D4037] ${THEME.bg} min-h-screen selection:bg-[#FFE5E5] notranslate`} translate="no">
      <main className="max-w-md mx-auto bg-[#FFF9F2] min-h-screen shadow-2xl relative overflow-hidden">
        
        {activeTab === 'itinerary' && (
          <ItineraryView 
            items={itineraryItems} 
            onOpenAdd={() => {
              setModalInitialData(null);
              setIsAddModalOpen(true);
            }}
            onDelete={handleDeleteItem}
          />
        )}
        
        {activeTab === 'explore' && (
          <ExploreView onAddToPlan={handleAddToPlan} />
        )}

        {activeTab === 'budget' && <BudgetView />}
        {activeTab === 'chat' && <ChatView />}
        {activeTab === 'saved' && (
          <div className="flex flex-col items-center justify-center h-screen pb-32 opacity-40">
             <div className="w-24 h-24 bg-white rounded-full flex items-center justify-center mb-6 shadow-sm">
                <Heart size={40} className="text-[#FFB7B2] fill-[#FFE5E5]" />
             </div>
             <p className="font-bold text-[#8B5E3C]">æ”¶è—å¤¾</p>
             <p className="text-sm">æŠŠå–œæ­¡çš„åœ°æ–¹éƒ½æ”¶é€²ä¾† ğŸ’•</p>
          </div>
        )}

        <BottomNav activeTab={activeTab} setActiveTab={setActiveTab} />
        
        <AddItemModal 
          isOpen={isAddModalOpen} 
          onClose={() => setIsAddModalOpen(false)}
          onSave={handleSaveItem}
          initialData={modalInitialData}
        />

      </main>
    </div>
  );
}